using System;using System.Drawing;using System.Threading.Tasks;using System.Windows.Forms;using LojaConstrucao.Data;using LojaConstrucao.Utils;namespace LojaConstrucao{public partial class LoginForm:Form{private bool isLogging=false;public LoginForm(){InitializeComponent();this.StartPosition=FormStartPosition.CenterScreen;this.FormBorderStyle=FormBorderStyle.FixedSingle;this.MaximizeBox=false;txtUsuario.Text="admin";txtSenha.Text="admin123";}private async void btnLogin_Click(object sender,EventArgs e){if(isLogging)return;try{isLogging=true;btnLogin.Enabled=false;btnLogin.Text="Validando...";if(!ValidarEntradas())return;string usuario=txtUsuario.Text.Trim();string senha=txtSenha.Text.Trim();bool loginValido=await DatabaseHelper.ValidarUsuarioAsync(usuario,senha);if(loginValido){MessageBox.Show("Login realizado com sucesso!","Sucesso",MessageBoxButtons.OK,MessageBoxIcon.Information);this.Hide();var mainForm=new MainForm();mainForm.FormClosed+=(s,args)=>this.Close();mainForm.Show();}else{MessageBox.Show("Usuario ou senha invalidos!","Erro de Autenticacao",MessageBoxButtons.OK,MessageBoxIcon.Warning);txtSenha.Clear();txtSenha.Focus();}}catch(Exception ex){Logger.LogError("Erro no processo de login",ex);MessageBox.Show("Erro interno durante o login.","Erro",MessageBoxButtons.OK,MessageBoxIcon.Error);}finally{isLogging=false;btnLogin.Enabled=true;btnLogin.Text="Entrar";}}private bool ValidarEntradas(){if(!ValidationHelper.IsValidString(txtUsuario.Text,3,50)){MessageBox.Show("Nome de usuario deve ter entre 3 e 50 caracteres.","Validacao",MessageBoxButtons.OK,MessageBoxIcon.Warning);txtUsuario.Focus();return false;}if(!ValidationHelper.IsValidPassword(txtSenha.Text)){MessageBox.Show("Senha deve ter pelo menos 4 caracteres.","Validacao",MessageBoxButtons.OK,MessageBoxIcon.Warning);txtSenha.Focus();return false;}return true;}}partial class LoginForm{private Label lblTitulo,lblUsuario,lblSenha;private TextBox txtUsuario,txtSenha;private Button btnLogin;private void InitializeComponent(){this.lblTitulo=new Label();this.lblUsuario=new Label();this.lblSenha=new Label();this.txtUsuario=new TextBox();this.txtSenha=new TextBox();this.btnLogin=new Button();this.lblTitulo.AutoSize=true;this.lblTitulo.Font=new Font("Microsoft Sans Serif",14F,FontStyle.Bold);this.lblTitulo.ForeColor=Color.DarkBlue;this.lblTitulo.Location=new Point(50,20);this.lblTitulo.Text="Sistema Loja Construcao v3.0";this.lblUsuario.AutoSize=true;this.lblUsuario.Location=new Point(30,70);this.lblUsuario.Text="Usuario:";this.txtUsuario.Location=new Point(100,67);this.txtUsuario.Size=new Size(180,23);this.lblSenha.AutoSize=true;this.lblSenha.Location=new Point(30,110);this.lblSenha.Text="Senha:";this.txtSenha.Location=new Point(100,107);this.txtSenha.PasswordChar='*';this.txtSenha.Size=new Size(180,23);this.btnLogin.BackColor=Color.DarkBlue;this.btnLogin.ForeColor=Color.White;this.btnLogin.Location=new Point(100,150);this.btnLogin.Size=new Size(180,35);this.btnLogin.Text="Entrar";this.btnLogin.Click+=new EventHandler(this.btnLogin_Click);this.ClientSize=new Size(350,220);this.Controls.Add(this.lblTitulo);this.Controls.Add(this.lblUsuario);this.Controls.Add(this.txtUsuario);this.Controls.Add(this.lblSenha);this.Controls.Add(this.txtSenha);this.Controls.Add(this.btnLogin);this.Text="Login - Sistema Loja Construcao";this.BackColor=Color.WhiteSmoke;}}}