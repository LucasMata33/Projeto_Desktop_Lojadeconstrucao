using System;using System.Drawing;using System.Threading.Tasks;using System.Windows.Forms;using LojaConstrucao.Models;using LojaConstrucao.Data;using LojaConstrucao.Utils;namespace LojaConstrucao.Forms{public partial class ProdutoForm:Form{private bool isOperating=false;public ProdutoForm(){InitializeComponent();this.StartPosition=FormStartPosition.CenterScreen;_=CarregarProdutosAsync();}private async void btnAdicionar_Click(object sender,EventArgs e){if(isOperating)return;try{isOperating=true;btnAdicionar.Enabled=false;btnAdicionar.Text="Adicionando...";if(!ValidarEntradas())return;var produto=new Produto{Nome=txtNome.Text.Trim(),Preco=decimal.Parse(txtPreco.Text.Replace('.',',')),Quantidade=int.Parse(txtQuantidade.Text)};bool sucesso=await DatabaseHelper.AdicionarProdutoAsync(produto);if(sucesso){MessageBox.Show("Produto adicionado com sucesso!","Sucesso",MessageBoxButtons.OK,MessageBoxIcon.Information);LimparCampos();await CarregarProdutosAsync();}else{MessageBox.Show("Erro ao adicionar produto.","Erro",MessageBoxButtons.OK,MessageBoxIcon.Error);}}catch(Exception ex){Logger.LogError("Erro adicionar produto form",ex);MessageBox.Show("Erro interno.","Erro",MessageBoxButtons.OK,MessageBoxIcon.Error);}finally{isOperating=false;btnAdicionar.Enabled=true;btnAdicionar.Text="Adicionar Produto";}}private async void btnRemover_Click(object sender,EventArgs e){if(dgvProdutos.SelectedRows.Count==0){MessageBox.Show("Selecione um produto para remover.","Atencao",MessageBoxButtons.OK,MessageBoxIcon.Warning);return;}var resultado=MessageBox.Show("Tem certeza que deseja remover este produto?","Confirmacao",MessageBoxButtons.YesNo,MessageBoxIcon.Question);if(resultado==DialogResult.Yes){try{var id=(int)dgvProdutos.SelectedRows[0].Cells["Id"].Value;bool sucesso=await DatabaseHelper.RemoverProdutoAsync(id);if(sucesso){MessageBox.Show("Produto removido com sucesso!","Sucesso",MessageBoxButtons.OK,MessageBoxIcon.Information);await CarregarProdutosAsync();}else{MessageBox.Show("Erro ao remover produto.","Erro",MessageBoxButtons.OK,MessageBoxIcon.Error);}}catch(Exception ex){Logger.LogError("Erro ao remover produto",ex);MessageBox.Show("Erro interno ao remover produto.","Erro",MessageBoxButtons.OK,MessageBoxIcon.Error);}}}private async Task CarregarProdutosAsync(){try{dgvProdutos.Rows.Clear();var produtos=await DatabaseHelper.ListarProdutosAsync();foreach(var p in produtos){dgvProdutos.Rows.Add(p.Id,p.Nome,p.Preco.ToString("C"),p.Quantidade);}}catch(Exception ex){Logger.LogError("Erro carregar produtos",ex);}}private bool ValidarEntradas(){if(!ValidationHelper.IsValidString(txtNome.Text,2,100)){MessageBox.Show("Nome deve ter entre 2 e 100 caracteres.","Validacao",MessageBoxButtons.OK,MessageBoxIcon.Warning);txtNome.Focus();return false;}if(!ValidationHelper.IsValidDecimal(txtPreco.Text.Replace('.',','),out decimal preco)||preco<=0){MessageBox.Show("Preco deve ser um numero positivo.","Validacao",MessageBoxButtons.OK,MessageBoxIcon.Warning);txtPreco.Focus();return false;}if(!ValidationHelper.IsValidInteger(txtQuantidade.Text,out int qtd)){MessageBox.Show("Quantidade deve ser um numero inteiro positivo.","Validacao",MessageBoxButtons.OK,MessageBoxIcon.Warning);txtQuantidade.Focus();return false;}return true;}private void LimparCampos(){txtNome.Clear();txtPreco.Clear();txtQuantidade.Clear();txtNome.Focus();}}partial class ProdutoForm{private Label lblTitulo,lblNome,lblPreco,lblQtd;private TextBox txtNome,txtPreco,txtQuantidade;private Button btnAdicionar,btnRemover;private DataGridView dgvProdutos;private void InitializeComponent(){this.lblTitulo=new Label();this.lblNome=new Label();this.lblPreco=new Label();this.lblQtd=new Label();this.txtNome=new TextBox();this.txtPreco=new TextBox();this.txtQuantidade=new TextBox();this.btnAdicionar=new Button();this.btnRemover=new Button();this.dgvProdutos=new DataGridView();((System.ComponentModel.ISupportInitialize)(this.dgvProdutos)).BeginInit();this.lblTitulo.AutoSize=true;this.lblTitulo.Font=new Font("Microsoft Sans Serif",14F,FontStyle.Bold);this.lblTitulo.ForeColor=Color.DarkBlue;this.lblTitulo.Location=new Point(20,20);this.lblTitulo.Text="Gerenciamento de Produtos";this.lblNome.AutoSize=true;this.lblNome.Location=new Point(20,70);this.lblNome.Text="Nome:";this.txtNome.Location=new Point(80,67);this.txtNome.Size=new Size(150,23);this.lblPreco.AutoSize=true;this.lblPreco.Location=new Point(250,70);this.lblPreco.Text="Preco:";this.txtPreco.Location=new Point(300,67);this.txtPreco.Size=new Size(80,23);this.lblQtd.AutoSize=true;this.lblQtd.Location=new Point(400,70);this.lblQtd.Text="Qtd:";this.txtQuantidade.Location=new Point(440,67);            this.txtQuantidade.Size=new Size(60,23);this.btnAdicionar.BackColor=Color.DarkGreen;this.btnAdicionar.ForeColor=Color.White;this.btnAdicionar.Location=new Point(20,110);this.btnAdicionar.Size=new Size(120,30);this.btnAdicionar.Text="Adicionar";this.btnAdicionar.Click+=new EventHandler(this.btnAdicionar_Click);this.btnRemover.BackColor=Color.DarkRed;this.btnRemover.ForeColor=Color.White;this.btnRemover.Location=new Point(150,110);this.btnRemover.Size=new Size(120,30);this.btnRemover.Text="Remover";this.btnRemover.Click+=new EventHandler(this.btnRemover_Click);this.dgvProdutos.AllowUserToAddRows=false;this.dgvProdutos.AllowUserToDeleteRows=false;this.dgvProdutos.AutoSizeColumnsMode=DataGridViewAutoSizeColumnsMode.Fill;this.dgvProdutos.Location=new Point(20,160);this.dgvProdutos.ReadOnly=true;this.dgvProdutos.SelectionMode=DataGridViewSelectionMode.FullRowSelect;this.dgvProdutos.Size=new Size(480,250);this.dgvProdutos.ColumnCount=4;this.dgvProdutos.Columns[0].Name="Id";this.dgvProdutos.Columns[0].HeaderText="ID";this.dgvProdutos.Columns[0].Width=50;this.dgvProdutos.Columns[1].Name="Nome";this.dgvProdutos.Columns[1].HeaderText="Nome";this.dgvProdutos.Columns[2].Name="Preco";this.dgvProdutos.Columns[2].HeaderText="Preco";this.dgvProdutos.Columns[2].Width=80;this.dgvProdutos.Columns[3].Name="Quantidade";this.dgvProdutos.Columns[3].HeaderText="Qtd";this.dgvProdutos.Columns[3].Width=60;this.ClientSize=new Size(520,430);this.Controls.Add(this.lblTitulo);this.Controls.Add(this.lblNome);this.Controls.Add(this.txtNome);this.Controls.Add(this.lblPreco);this.Controls.Add(this.txtPreco);this.Controls.Add(this.lblQtd);this.Controls.Add(this.txtQuantidade);this.Controls.Add(this.btnAdicionar);this.Controls.Add(this.btnRemover);this.Controls.Add(this.dgvProdutos);this.Text="Produtos";this.BackColor=Color.WhiteSmoke;((System.ComponentModel.ISupportInitialize)(this.dgvProdutos)).EndInit();}}}