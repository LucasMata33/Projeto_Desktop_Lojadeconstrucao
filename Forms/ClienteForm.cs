using System;using System.Drawing;using System.Threading.Tasks;using System.Windows.Forms;using LojaConstrucao.Models;using LojaConstrucao.Data;using LojaConstrucao.Utils;namespace LojaConstrucao.Forms{public partial class ClienteForm:Form{private bool isOperating=false;public ClienteForm(){InitializeComponent();this.StartPosition=FormStartPosition.CenterScreen;_=CarregarClientesAsync();}private async void btnAdicionar_Click(object sender,EventArgs e){if(isOperating)return;try{isOperating=true;btnAdicionar.Enabled=false;btnAdicionar.Text="Adicionando...";if(!ValidarEntradas())return;var cliente=new Cliente{Nome=txtNome.Text.Trim(),Telefone=txtTelefone.Text.Trim(),Email=txtEmail.Text.Trim(),Endereco=txtEndereco.Text.Trim()};bool sucesso=await DatabaseHelper.AdicionarClienteAsync(cliente);if(sucesso){MessageBox.Show("Cliente adicionado com sucesso!","Sucesso",MessageBoxButtons.OK,MessageBoxIcon.Information);LimparCampos();await CarregarClientesAsync();}else{MessageBox.Show("Erro ao adicionar cliente.","Erro",MessageBoxButtons.OK,MessageBoxIcon.Error);}}catch(Exception ex){Logger.LogError("Erro adicionar cliente form",ex);MessageBox.Show("Erro interno.","Erro",MessageBoxButtons.OK,MessageBoxIcon.Error);}finally{isOperating=false;btnAdicionar.Enabled=true;btnAdicionar.Text="Adicionar Cliente";}}private async void btnRemover_Click(object sender,EventArgs e){if(dgvClientes.SelectedRows.Count==0){MessageBox.Show("Selecione um cliente para remover.","Atencao",MessageBoxButtons.OK,MessageBoxIcon.Warning);return;}var resultado=MessageBox.Show("Tem certeza que deseja remover este cliente?","Confirmacao",MessageBoxButtons.YesNo,MessageBoxIcon.Question);if(resultado==DialogResult.Yes){try{var id=(int)dgvClientes.SelectedRows[0].Cells["Id"].Value;bool sucesso=await DatabaseHelper.RemoverClienteAsync(id);if(sucesso){MessageBox.Show("Cliente removido com sucesso!","Sucesso",MessageBoxButtons.OK,MessageBoxIcon.Information);await CarregarClientesAsync();}else{MessageBox.Show("Erro ao remover cliente.","Erro",MessageBoxButtons.OK,MessageBoxIcon.Error);}}catch(Exception ex){Logger.LogError("Erro ao remover cliente",ex);MessageBox.Show("Erro interno ao remover cliente.","Erro",MessageBoxButtons.OK,MessageBoxIcon.Error);}}}private async Task CarregarClientesAsync(){try{dgvClientes.Rows.Clear();var clientes=await DatabaseHelper.ListarClientesAsync();foreach(var c in clientes){dgvClientes.Rows.Add(c.Id,c.Nome,c.Telefone,c.Email,c.Endereco);}}catch(Exception ex){Logger.LogError("Erro carregar clientes",ex);}}private bool ValidarEntradas(){if(!ValidationHelper.IsValidString(txtNome.Text,2,100)){MessageBox.Show("Nome deve ter entre 2 e 100 caracteres.","Validacao",MessageBoxButtons.OK,MessageBoxIcon.Warning);txtNome.Focus();return false;}if(!string.IsNullOrWhiteSpace(txtEmail.Text)&&!ValidationHelper.IsValidEmail(txtEmail.Text)){MessageBox.Show("Email deve ter formato valido.","Validacao",MessageBoxButtons.OK,MessageBoxIcon.Warning);txtEmail.Focus();return false;}if(!string.IsNullOrWhiteSpace(txtTelefone.Text)&&!ValidationHelper.IsValidPhone(txtTelefone.Text)){MessageBox.Show("Telefone deve ter formato valido.","Validacao",MessageBoxButtons.OK,MessageBoxIcon.Warning);txtTelefone.Focus();return false;}return true;}private void LimparCampos(){txtNome.Clear();txtTelefone.Clear();txtEmail.Clear();txtEndereco.Clear();txtNome.Focus();}}partial class ClienteForm{private Label lblTitulo,lblNome,lblTelefone,lblEmail,lblEndereco;private TextBox txtNome,txtTelefone,txtEmail,txtEndereco;private Button btnAdicionar,btnRemover;private DataGridView dgvClientes;private void InitializeComponent(){this.lblTitulo=new Label();this.lblNome=new Label();this.lblTelefone=new Label();this.lblEmail=new Label();this.lblEndereco=new Label();this.txtNome=new TextBox();this.txtTelefone=new TextBox();this.txtEmail=new TextBox();this.txtEndereco=new TextBox();this.btnAdicionar=new Button();this.btnRemover=new Button();this.dgvClientes=new DataGridView();((System.ComponentModel.ISupportInitialize)(this.dgvClientes)).BeginInit();this.lblTitulo.AutoSize=true;this.lblTitulo.Font=new Font("Microsoft Sans Serif",14F,FontStyle.Bold);this.lblTitulo.ForeColor=Color.DarkBlue;this.lblTitulo.Location=new Point(20,20);this.lblTitulo.Text="Gerenciamento de Clientes";this.lblNome.AutoSize=true;this.lblNome.Location=new Point(20,70);this.lblNome.Text="Nome:";this.txtNome.Location=new Point(80,67);this.txtNome.Size=new Size(200,23);this.lblTelefone.AutoSize=true;this.lblTelefone.Location=new Point(300,70);this.lblTelefone.Text="Telefone:";this.txtTelefone.Location=new Point(370,67);this.txtTelefone.Size=new Size(120,23);this.lblEmail.AutoSize=true;this.lblEmail.Location=new Point(20,110);this.lblEmail.Text="Email:";this.txtEmail.Location=new Point(80,107);this.txtEmail.Size=new Size(200,23);this.lblEndereco.AutoSize=true;this.lblEndereco.Location=new Point(300,110);this.lblEndereco.Text="Endereco:";this.txtEndereco.Location=new Point(370,107);this.txtEndereco.Size=new Size(200,23);this.btnAdicionar.BackColor=Color.DarkGreen;this.btnAdicionar.ForeColor=Color.White;this.btnAdicionar.Location=new Point(20,150);this.btnAdicionar.Size=new Size(120,30);this.btnAdicionar.Text="Adicionar Cliente";this.btnAdicionar.Click+=new EventHandler(this.btnAdicionar_Click);this.btnRemover.BackColor=Color.DarkRed;this.btnRemover.ForeColor=Color.White;this.btnRemover.Location=new Point(150,150);this.btnRemover.Size=new Size(120,30);this.btnRemover.Text="Remover Cliente";this.btnRemover.Click+=new EventHandler(this.btnRemover_Click);this.dgvClientes.AllowUserToAddRows=false;this.dgvClientes.AllowUserToDeleteRows=false;this.dgvClientes.AutoSizeColumnsMode=DataGridViewAutoSizeColumnsMode.Fill;this.dgvClientes.Location=new Point(20,200);this.dgvClientes.ReadOnly=true;this.dgvClientes.SelectionMode=DataGridViewSelectionMode.FullRowSelect;this.dgvClientes.Size=new Size(650,250);this.dgvClientes.ColumnCount=5;this.dgvClientes.Columns[0].Name="Id";this.dgvClientes.Columns[0].HeaderText="ID";this.dgvClientes.Columns[0].Width=50;this.dgvClientes.Columns[1].Name="Nome";this.dgvClientes.Columns[1].HeaderText="Nome";this.dgvClientes.Columns[2].Name="Telefone";this.dgvClientes.Columns[2].HeaderText="Telefone";this.dgvClientes.Columns[2].Width=100;this.dgvClientes.Columns[3].Name="Email";this.dgvClientes.Columns[3].HeaderText="Email";this.dgvClientes.Columns[4].Name="Endereco";this.dgvClientes.Columns[4].HeaderText="Endereco";this.ClientSize=new Size(690,470);this.Controls.Add(this.lblTitulo);this.Controls.Add(this.lblNome);this.Controls.Add(this.txtNome);this.Controls.Add(this.lblTelefone);this.Controls.Add(this.txtTelefone);this.Controls.Add(this.lblEmail);this.Controls.Add(this.txtEmail);this.Controls.Add(this.lblEndereco);this.Controls.Add(this.txtEndereco);this.Controls.Add(this.btnAdicionar);this.Controls.Add(this.btnRemover);this.Controls.Add(this.dgvClientes);this.Text="Gerenciamento de Clientes";this.BackColor=Color.WhiteSmoke;((System.ComponentModel.ISupportInitialize)(this.dgvClientes)).EndInit();}}}